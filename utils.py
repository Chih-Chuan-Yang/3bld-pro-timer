# utils.py
import sys

# 自動安裝檢查
def check_dependencies():
    try:
        import pycuber
    except ImportError:
        import subprocess
        subprocess.check_call([sys.executable, "-m", "pip", "install", "pycuber"])

# WCA 配色與定義
WCA_MAP = {
    '[y]': '白色', '[w]': '黃色', '[g]': '綠色',
    '[b]': '藍色', '[r]': '橘色', '[o]': '紅色'
}

COLOR_PALETTE = {
    'white': '#FFFFFF', 'yellow': '#FFD500', 'green': '#009E60',
    'blue': '#0051BA', 'orange': '#FF5800', 'red': '#C41E3A'
}

PYCUBER_TO_WCA = {
    '[y]': 'white', '[w]': 'yellow', '[g]': 'green',
    '[b]': 'blue', '[r]': 'orange', '[o]': 'red'
}

# --- 角塊資料庫 (完整版) ---
C_COORDS = {
    'UFR': [('U',2,2), ('F',0,2), ('R',0,0)], # Buffer
    'UBL': [('U',0,0), ('L',0,0), ('B',0,2)],
    'UBR': [('U',0,2), ('B',0,0), ('R',0,2)],
    'UFL': [('U',2,0), ('F',0,0), ('L',0,2)],
    'DFL': [('D',0,0), ('F',2,0), ('L',2,2)],
    'DFR': [('D',0,2), ('F',2,2), ('R',2,0)],
    'DBR': [('D',2,2), ('B',2,0), ('R',2,2)],
    'DBL': [('D',2,0), ('B',2,2), ('L',2,0)]
}

C_TARGET_COORDS = C_COORDS.copy()
C_TARGET_COORDS.update({
    'FUL': [('F',0,0), ('L',0,2), ('U',2,0)], 'LUF': [('L',0,2), ('U',2,0), ('F',0,0)],
    'FDR': [('F',2,2), ('D',0,2), ('R',2,0)], 'FDL': [('F',2,0), ('L',2,2), ('D',0,0)],
    'RUB': [('R',0,2), ('U',0,2), ('B',0,0)], 'RDB': [('R',2,2), ('D',2,2), ('B',2,0)],
    'RDF': [('R',2,0), ('F',2,2), ('D',0,2)], 'BUR': [('B',0,0), ('R',0,2), ('U',0,2)],
    'BUL': [('B',0,2), ('U',0,0), ('L',0,0)], 'BDL': [('B',2,2), ('D',2,0), ('L',2,0)],
    'BDR': [('B',2,0), ('R',2,2), ('D',2,2)], 'LUB': [('L',0,0), ('B',0,2), ('U',0,0)],
    'LDF': [('L',2,2), ('D',0,0), ('F',2,0)], 'LDB': [('L',2,0), ('B',2,2), ('D',2,0)]
})

C_PIECE_DEFS = {
    frozenset(['白色', '藍色', '橘色']): 'UBL', frozenset(['白色', '紅色', '藍色']): 'UBR',
    frozenset(['白色', '綠色', '橘色']): 'UFL', frozenset(['白色', '綠色', '紅色']): 'BUFFER',
    frozenset(['黃色', '綠色', '橘色']): 'DFL', frozenset(['黃色', '紅色', '綠色']): 'DFR',
    frozenset(['黃色', '藍色', '紅色']): 'DBR', frozenset(['黃色', '橘色', '藍色']): 'DBL'
}

C_TARGETS = {
    ('UBL', '白色'): 'UBL', ('UBL', '藍色'): 'BUL', ('UBL', '橘色'): 'LUB',
    ('UBR', '白色'): 'UBR', ('UBR', '紅色'): 'RUB', ('UBR', '藍色'): 'BUR',
    ('UFL', '白色'): 'UFL', ('UFL', '綠色'): 'FUL', ('UFL', '橘色'): 'LUF',
    ('DFL', '黃色'): 'DFL', ('DFL', '綠色'): 'FDL', ('DFL', '橘色'): 'LDF',
    ('DFR', '黃色'): 'DFR', ('DFR', '綠色'): 'FDR', ('DFR', '紅色'): 'RDF',
    ('DBR', '黃色'): 'DBR', ('DBR', '藍色'): 'BDR', ('DBR', '紅色'): 'RDB',
    ('DBL', '黃色'): 'DBL', ('DBL', '藍色'): 'BDL', ('DBL', '橘色'): 'LDB'
}

C_PRIORITY = ['UBL', 'UBR', 'UFL', 'DFL', 'DFR', 'DBR', 'DBL']

C_TWIST_MAP = {
    'UBL': {0: 'Normal', 2: '順時針', 1: '逆時針'}, 'UBR': {0: 'Normal', 2: '順時針', 1: '逆時針'},
    'UFL': {0: 'Normal', 2: '順時針', 1: '逆時針'}, 'DFL': {0: 'Normal', 1: '順時針', 2: '逆時針'},
    'DFR': {0: 'Normal', 2: '順時針', 1: '逆時針'}, 'DBR': {0: 'Normal', 1: '順時針', 2: '逆時針'},
    'DBL': {0: 'Normal', 2: '順時針', 1: '逆時針'}
}

# --- 邊塊資料庫 (完整版) ---
E_COORDS = {
    'UF': [('U',2,1), ('F',0,1)], 'FU': [('F',0,1), ('U',2,1)],
    'UB': [('U',0,1), ('B',0,1)], 'BU': [('B',0,1), ('U',0,1)],
    'UL': [('U',1,0), ('L',0,1)], 'LU': [('L',0,1), ('U',1,0)],
    'UR': [('U',1,2), ('R',0,1)], 'RU': [('R',0,1), ('U',1,2)],
    'DF': [('D',0,1), ('F',2,1)], 'FD': [('F',2,1), ('D',0,1)],
    'DR': [('D',1,2), ('R',2,1)], 'RD': [('R',2,1), ('D',1,2)],
    'DB': [('D',2,1), ('B',2,1)], 'BD': [('B',2,1), ('D',2,1)],
    'DL': [('D',1,0), ('L',2,1)], 'LD': [('L',2,1), ('D',1,0)],
    'FR': [('F',1,2), ('R',1,0)], 'RF': [('R',1,0), ('F',1,2)],
    'FL': [('F',1,0), ('L',1,2)], 'LF': [('L',1,2), ('F',1,0)],
    'BR': [('B',1,0), ('R',1,2)], 'RB': [('R',1,2), ('B',1,0)],
    'BL': [('B',1,2), ('L',1,0)], 'LB': [('L',1,0), ('B',1,2)]
}

E_PIECE_DEFS = {
    frozenset(['白色', '藍色']): 'UB', frozenset(['白色', '橘色']): 'UL',
    frozenset(['白色', '紅色']): 'UR', frozenset(['白色', '綠色']): 'BUFFER',
    frozenset(['黃色', '綠色']): 'DF', frozenset(['黃色', '紅色']): 'DR',
    frozenset(['黃色', '藍色']): 'DB', frozenset(['黃色', '橘色']): 'DL',
    frozenset(['綠色', '紅色']): 'FR', frozenset(['綠色', '橘色']): 'FL',
    frozenset(['藍色', '紅色']): 'BR', frozenset(['藍色', '橘色']): 'BL'
}

E_TARGETS = {
    ('UB', '白色'): 'UB', ('UB', '藍色'): 'BU', ('UL', '白色'): 'UL', ('UL', '橘色'): 'LU',
    ('UR', '白色'): 'UR', ('UR', '紅色'): 'RU', ('UF', '白色'): 'UF', ('UF', '綠色'): 'FU',
    ('DF', '黃色'): 'DF', ('DF', '綠色'): 'FD', ('DR', '黃色'): 'DR', ('DR', '紅色'): 'RD',
    ('DB', '黃色'): 'DB', ('DB', '藍色'): 'BD', ('DL', '黃色'): 'DL', ('DL', '橘色'): 'LD',
    ('FR', '綠色'): 'FR', ('FR', '紅色'): 'RF', ('FL', '綠色'): 'FL', ('FL', '橘色'): 'LF',
    ('BR', '藍色'): 'BR', ('BR', '紅色'): 'RB', ('BL', '藍色'): 'BL', ('BL', '橘色'): 'LB'
}

E_PRIORITY = ['UL', 'UB', 'UR', 'FR', 'FL', 'DF', 'BL', 'BR', 'DR', 'DL', 'DB']